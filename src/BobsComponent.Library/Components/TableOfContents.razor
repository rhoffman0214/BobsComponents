@* Table of Contents Component for Page Navigation *@

<div class="table-of-contents @(IsSticky ? "sticky" : "")" @ref="tocElement">
    <div class="toc-header" @onclick="ToggleCollapse">
        <h3>@Title</h3>
        <button class="toggle-btn" aria-label="@(isCollapsed ? "Expand menu" : "Collapse menu")" type="button">
            <span class="toggle-icon @(isCollapsed ? "collapsed" : "expanded")">â–¼</span>
        </button>
    </div>

    <nav class="toc-nav @(isCollapsed ? "collapsed" : "")" aria-label="Page navigation">
        <ul class="toc-list">
            @foreach (var item in Items)
            {
                <li class="toc-item level-@item.Level">
                    <a href="#@item.Id" @onclick="() => ScrollToSection(item.Id)" @onclick:preventDefault>@item.Text</a>
                </li>
            }
        </ul>
    </nav>
</div>

@code {
    [Parameter] public List<TocItem> Items { get; set; } = new();
    [Parameter] public string? Title { get; set; } = "On This Page";
    [Parameter] public bool IsSticky { get; set; } = true;

    private bool isCollapsed = false;
    private ElementReference tocElement;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && IsSticky)
        {
            // Add scroll detection for auto-collapse behavior
            await JSRuntime.InvokeVoidAsync("TableOfContents.init", tocElement);
        }
    }

    private void ToggleCollapse()
    {
        isCollapsed = !isCollapsed;
    }

    private async Task ScrollToSection(string sectionId)
    {
        await JSRuntime.InvokeVoidAsync("TableOfContents.scrollToSection", sectionId);
    }

    [Inject] private IJSRuntime JSRuntime { get; set; } = default!;

    public class TocItem
    {
        public required string Id { get; set; }        // Section anchor ID
        public required string Text { get; set; }      // Display text
        public int Level { get; set; } = 1;           // Heading level (1-3 for future)
    }
}
